<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:f="sap.f"
    xmlns:u="sap.ui.unified"
    xmlns:l="sap.ui.layout"
    xmlns:form="sap.ui.layout.form"
>
    <Dialog
        id="profileDialog"
        stretch="{= ${device>/system/phone} }"
        contentWidth="80%"
        contentHeight="auto"
        resizable="true"
        draggable="true"
    >
        <customHeader>
            <Bar class="profileHeaderBar">
                <contentMiddle>
                    <Title
                        text="My Account"
                        level="H4"
                    />
                </contentMiddle>
                <contentRight>
                    <Button
                        icon="sap-icon://decline"
                        type="Transparent"
                        press="onProfileDialogClose"
                    />
                </contentRight>
            </Bar>
        </customHeader>

        <Bar
            design="Header"
            class="sapUiSmallMarginBottom"
        >
            <contentRight>
                <Button
                    text="{= ${profileData>/isEditMode} ? 'Save' : 'Edit'}"
                    press="onEditSaveProfile"
                    class="myUnifiedBtn"
                />
            </contentRight>
        </Bar>

        <VBox class="sapUiSmallMargin profileMainContainer">
            <f:Card>
                <f:content>
                    <HBox
                        justifyContent="Start"
                        alignItems="Start"
                        class="sapUiMediumMargin"
                    >
                        <FlexBox
                            alignItems="Start"
                            wrap="Wrap"
                            class="profileTopBox"
                        >
                            <!-- AVATAR SECTION (unchanged) -->
                            <FlexBox
                                direction="Column"
                                alignItems="Center"
                                class="avatarWrapper"
                                width="180px"
                            >
                                <Avatar
                                    src="{path: 'profileData>/photo'}"
                                    initials="{profileData>/initials}"
                                    displayShape="Circle"
                                    displaySize="XL"
                                    press="onPreviewProfilePhoto"
                                    class="sapUiTinyMargin"
                                />

                                <Button
                                    id="avatarEditBtn"
                                    icon="sap-icon://edit"
                                    press="onPressAvatarEdit"
                                    class="avatarEditIcon"
                                    type="Transparent"
                                />

                                <u:FileUploader
                                    id="fileUploaderAvatar"
                                    uploadOnChange="false"
                                    change="onAvatarFileSelected"
                                    fileType="png,jpg,jpeg"
                                    class="hiddenUploader"
                                    buttonOnly="true"
                                    iconOnly="true"
                                />
                            </FlexBox>

                            <!-- MAIN GRID -->
                            <l:Grid
                                defaultSpan="L4 M6 S12"
                                hSpacing="2"
                                vSpacing="1"
                                class="sapUiSmallMarginLeft"
                            >
                                <!-- FULL NAME -->
                                <VBox>
                                    <Label text="Full Name:" />

                                    <HBox
                                        visible="{= !${profileData>/isEditMode}}"
                                    >
                                        <Text
                                            text="{profileData>/Salutation}"
                                        />
                                        <Text
                                            text="{profileData>/name}"
                                            class="sapUiSmallMarginBegin"
                                        />
                                    </HBox>

                                    <HBox visible="{profileData>/isEditMode}">
                                        <Select
                                            selectedKey="{profileData>/Salutation}"
                                            width="90px"
                                        >
                                            <core:Item
                                                key="Mr."
                                                text="Mr."
                                            />
                                            <core:Item
                                                key="Mrs."
                                                text="Mrs."
                                            />
                                            <core:Item
                                                key="Miss"
                                                text="Miss"
                                            />
                                        </Select>

                                        <Input
                                            id="id_Name"
                                            value="{profileData>/name}"
                                            class="sapUiSmallMarginBegin"
                                            valueStateText="Enter Customer Name"
                                            change="onChange"
                                        />
                                    </HBox>
                                </VBox>

                                <!-- EMAIL -->
                                <VBox>
                                    <Label text="Email:" />

                                    <Text
                                        text="{profileData>/email}"
                                        visible="{= !${profileData>/isEditMode}}"
                                    />

                                    <Input
                                        id="id_mail"
                                        value="{profileData>/email}"
                                        type="Email"
                                        valueStateText="Enter Email Id"
                                        change="onChange"
                                        visible="{profileData>/isEditMode}"
                                    />
                                </VBox>

                                <!-- CITY -->
                                <VBox>
                                    <Label text="City:" />

                                    <Text
                                        text="{profileData>/city}"
                                        visible="{= !${profileData>/isEditMode}}"
                                    />

                                    <ComboBox
                                        id="id_city"
                                        change="onChange"
                                        placeholder="Enter City"
                                        showSecondaryValues="true"
                                        items="{path:'CityModel>/',length:1000}"
                                        selectedKey="{profileData>/city}"
                                        valueStateText="Select City"
                                        visible="{profileData>/isEditMode}"
                                    >
                                        <core:ListItem
                                            key="{CityModel>cityName}"
                                            text="{CityModel>cityName}"
                                        />
                                    </ComboBox>
                                </VBox>

                                <!-- DOB -->
                                <VBox>
                                    <Label text="Date of Birth:" />

                                    <Text
                                        text="{profileData>/dob}"
                                        visible="{= !${profileData>/isEditMode}}"
                                    />

                                    <DatePicker
                                        id="id_dob"
                                        value="{profileData>/dob}"
                                        displayFormat="dd/MM/yyyy"
                                        valueFormat="dd/MM/yyyy"
                                        change="onDateChange"
                                        visible="{profileData>/isEditMode}"
                                    />
                                </VBox>

                                <!-- COUNTRY -->
                                <VBox>
                                    <Label text="Country:" />

                                    <Text
                                        text="{profileData>/country}"
                                        visible="{= !${profileData>/isEditMode}}"
                                    />

                                    <ComboBox
                                        id="id_country"
                                        items="{path:'CountryModel>/',length:1000}"
                                        selectedKey="{profileData>/country}"
                                        showSecondaryValues="true"
                                        placeholder="Enter Country"
                                        valueStateText="Select Country"
                                        selectionChange="onCountrySelectionChange"
                                        change="MC_onChangeCountry"
                                        visible="{profileData>/isEditMode}"
                                    >
                                        <core:ListItem
                                            key="{CountryModel>countryName}"
                                            text="{CountryModel>countryName}"
                                        />
                                    </ComboBox>
                                </VBox>

                                <!-- MOBILE -->
                                <VBox>
                                    <Label text="Mobile Number:" />

                                    <HBox
                                        visible="{= !${profileData>/isEditMode}}"
                                    >
                                        <Text text="{profileData>/stdCode}" />
                                        <Text
                                            text="{profileData>/phone}"
                                            class="sapUiSmallMarginBegin"
                                        />
                                    </HBox>

                                    <HBox visible="{profileData>/isEditMode}">
                                        <Input
                                            id="id_std"
                                            value="{profileData>/stdCode}"
                                            width="70px"
                                            editable="false"
                                        />

                                        <Input
                                            id="id_phone"
                                            value="{profileData>/phone}"
                                            class="sapUiSmallMarginBegin"
                                            maxLength="10"
                                            type="Number"
                                            liveChange="onChange"
                                            placeholder="Enter Contact Number"
                                            valueStateText="Enter Contact Number"
                                        />
                                    </HBox>
                                </VBox>

                                <!-- GENDER -->
                                <VBox>
                                    <Label text="Gender:" />

                                    <Text
                                        text="{profileData>/gender}"
                                        visible="{= !${profileData>/isEditMode}}"
                                    />

                                    <ComboBox
                                        id="id_gender"
                                        selectedKey="{profileData>/gender}"
                                        visible="{profileData>/isEditMode}"
                                        change="onChange"
                                    >
                                        <core:Item
                                            key="Male"
                                            text="Male"
                                        />
                                        <core:Item
                                            key="Female"
                                            text="Female"
                                        />
                                        <core:Item
                                            key="Other"
                                            text="Other"
                                        />
                                    </ComboBox>
                                </VBox>

                                <!-- STATE -->
                                <VBox>
                                    <Label text="State:" />

                                    <Text
                                        text="{profileData>/state}"
                                        visible="{= !${profileData>/isEditMode}}"
                                    />

                                    <ComboBox
                                        id="id_state"
                                        items="{path:'StateModel>/',length:1000}"
                                        selectedKey="{profileData>/state}"
                                        placeholder="Enter State"
                                        valueStateText="Select State"
                                        change="CC_onChangeState"
                                        visible="{profileData>/isEditMode}"
                                    >
                                        <core:ListItem
                                            key="{StateModel>stateName}"
                                            text="{StateModel>stateName}"
                                        />
                                    </ComboBox>
                                </VBox>

                                <!-- ADDRESS -->
                                <VBox class="sapUiSmallMarginTop">
                                    <Label text="Address:" />

                                    <Text
                                        text="{profileData>/address}"
                                        visible="{= !${profileData>/isEditMode}}"
                                        wrapping="true"
                                    />

                                    <Input
                                        id="id_address"
                                        value="{profileData>/address}"
                                        visible="{profileData>/isEditMode}"
                                    />
                                </VBox>
                            </l:Grid>
                        </FlexBox>
                    </HBox>
                </f:content>
            </f:Card>

            <!-- BOOKING HISTORY -->
            <Table
                id="IdProfileaTable"
                mode="SingleSelectLeft"
                noDataText="No booking history found"
                 items="{
                    path: 'profileData>/bookings',
                    sorter: [
                        { path: 'bookingGroup', descending: false, group: true },
                        { path: 'Startdate', descending: true }
                    ]
                }"
            >
                <headerToolbar>
                    <OverflowToolbar>
                        <Title
                            text="Booking History ({=${profileData>/bookings}.length})"
                        />
                        <ToolbarSpacer />
                    </OverflowToolbar>
                </headerToolbar>

                 <columns>
                    <Column demandPopin="true">
                        <Text text="Customer Name" />
                    </Column>
                    <Column demandPopin="true">
                        <Text text="Start Date" />
                    </Column>
                    <Column demandPopin="true">
                        <Text text="Room" />
                    </Column>
                    <Column
                        demandPopin="true"
                        minScreenWidth="Tablet"
                    >
                        <Text text="Amount" />
                    </Column>
                    <Column
                        demandPopin="true"
                        minScreenWidth="Tablet"
                    >
                        <Text text="Status" />
                    </Column>
                </columns>

                <items>
                    <ColumnListItem
                        type="Navigation"
                        press="onPressBookingRow"
                    >
                        <cells>
                            <Text text="{profileData>customerName}" />
                            <Text text="{profileData>Startdate}" />
                            <Text text="{profileData>room}" />
                            <Text text="{profileData>amount}" />
                            <Text text="{profileData>status}" />
                        </cells>
                    </ColumnListItem>
                </items>
            </Table>
        </VBox>
    </Dialog>
</core:FragmentDefinition>