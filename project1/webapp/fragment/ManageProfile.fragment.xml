<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:f="sap.f"
    xmlns:u="sap.ui.unified"
    xmlns:l="sap.ui.layout"
    xmlns:form="sap.ui.layout.form"
    xmlns:m="sap.m"
>
    <Dialog
        id="profileDialog"
        stretch="{= ${device>/system/phone} }"
        contentWidth="90%"
        contentHeight="auto"
        horizontalScrolling="false"
        verticalScrolling="true"
        resizable="true"
        draggable="true"> 
    
        <customHeader>
            <Bar class="profileHeaderBar">
                <contentMiddle>
                    <Title
                        text="My Account"
                        level="H4"
                    />
                </contentMiddle>

                <contentRight>
                 <Button
                        text="Logout"
                        press="onLogout"
                        class="myUnifiedBtn"
                    />
                    <Button
                        icon="sap-icon://decline"
                        press="onProfileDialogClose"
                        type="Transparent"
                    />
                </contentRight>
            </Bar>
        </customHeader>

        <VBox class="sapUiSmallMargin profileMainContainer">
            <f:Card class="profileCard">
                <f:content>
                    <FlexBox
                        alignItems="Start"
                        wrap="Wrap"
                        class="profileTopBox"
                    >
                        <FlexBox
                            direction="Column"
                            alignItems="Center"
                            class="avatarWrapper"
                            width="180px" 
                        >
                            <Avatar
                                src="{path: 'profileData>/photo', formatter: '.Formatter.getImageSrc'}"
                                initials="{profileData>/initials}"
                                displayShape="Circle"
                                displaySize="XL"
                                press="onPreviewProfilePhoto"
                                class="sapUiTinyMargin"
                            />
                            <Button
                                id="avatarEditBtn"
                                icon="sap-icon://edit"
                                type="Transparent"
                                class="avatarEditIcon"
                                press="onPressAvatarEdit"
                            />
                            <u:FileUploader
                                id="fileUploaderAvatar"
                                uploadOnChange="false"
                                change="onAvatarFileSelected"
                                fileType="png,jpg,jpeg"
                                class="hiddenUploader"
                                buttonOnly="true"
                                iconOnly="true"
                            />
                        </FlexBox>

                        <VBox
                            width="auto"
                            class="detailsContainer"
                        >
                            <HBox class="detailRow">
                                <Label
                                    text="Name:"
                                    class="detailLabel"
                                />
                                <Text
                                    text="{profileData>/name}"
                                    class="detailValue"
                                />
                            </HBox>
                            <HBox class="detailRow">
                                <Label
                                    text="DOB:"
                                    class="detailLabel"
                                />
                                <Text
                                    text="{profileData>/dob}"
                                    class="detailValue"
                                />
                            </HBox>
                            <HBox class="detailRow">
                                <Label
                                    text="Gender:"
                                    class="detailLabel"
                                />
                                <Text
                                    text="{profileData>/gender}"
                                    class="detailValue"
                                />
                            </HBox>
                            <HBox class="detailRow">
                                <Label
                                    text="Mobile:"
                                    class="detailLabel"
                                />
                                <Text
                                    text="{profileData>/phone}"
                                    class="detailValue"
                                />
                            </HBox>
                            <HBox class="detailRow">
                                <Label
                                    text="Email:"
                                    class="detailLabel"
                                />
                                <Text
                                    text="{profileData>/email}"
                                    class="detailValue"
                                />
                            </HBox>
                            <HBox
                                class="detailRow"
                                alignItems="Start"
                            >
                                <Label
                                    text="Address:"
                                    class="detailLabel"
                                />
                                <Text
                                    text="{profileData>/address}"
                                    class="detailValue"
                                    wrapping="true"
                                />
                            </HBox>
                        </VBox>
                    </FlexBox>
                </f:content>
            </f:Card>

            <Table
                id="IdProfileaTable"
                mode="SingleSelectLeft"
                noDataText="No booking history found"
                items="{
                    path: 'profileData>/bookings',
                    sorter: [
                        { path: 'bookingGroup', descending: false, group: true },
                        { path: 'Startdate', descending: true }
                    ]
                }"
            >
                <headerToolbar>
                    <OverflowToolbar>
                        <Title
                            text="Booking History ({=${profileData>/bookings}.length})"
                        />
                        <ToolbarSpacer />
                    </OverflowToolbar>
                </headerToolbar>

                <columns>
                    <Column demandPopin="true">
                        <Text text="Customer Name" />
                    </Column>
                    <Column demandPopin="true">
                        <Text text="Start Date" />
                    </Column>
                    <Column demandPopin="true">
                        <Text text="Room" />
                    </Column>
                    <Column
                        demandPopin="true"
                        minScreenWidth="Tablet"
                    >
                        <Text text="Amount" />
                    </Column>
                    <Column
                        demandPopin="true"
                        minScreenWidth="Tablet"
                    >
                        <Text text="Status" />
                    </Column>
                </columns>

                <items>
                    <ColumnListItem
                        type="Navigation"
                        press="onPressBookingRow"
                    >
                        <cells>
                            <Text text="{profileData>customerName}" />
                            <Text text="{profileData>Startdate}" />
                            <Text text="{profileData>room}" />
                            <Text
                                text="{path:'profileData>amount', formatter: '.Formatter.formatCurrency'}"
                            />
                            <Text text="{profileData>status}" />
                        </cells>
                    </ColumnListItem>
                </items>
            </Table>
        </VBox>
    </Dialog>
</core:FragmentDefinition>