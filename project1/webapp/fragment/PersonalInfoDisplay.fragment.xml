<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:f="sap.ui.layout.form"
    xmlns:core="sap.ui.core">

    <!-- Renders ONE person (context comes from the List item) -->
    <Panel
        headerText="{= 'Personal Information - ' + (${HostelModel>FullName} || 'Person') }"
        expandable="false"
        class="customPanelHeader">

        <!-- Personal Info -->
        <f:SimpleForm
            editable="false"
            layout="ColumnLayout"
            columnsM="1"
            columnsL="2"
            columnsXL="2"
            labelSpanXL="4"
            labelSpanL="3"
            labelSpanM="4"
            labelSpanS="12">
            <f:content>
                <Label text="Full Name" />
                <Text text="{HostelModel>FullName}" />
                <Label text="Date of Birth" />
                <Text text="{path:'HostelModel>DateOfBirth', formatter: '.Formatter.DateFormat'}" />
                <Label text="Gender" />
                <Text text="{HostelModel>Gender}" />
                <Label text="Mobile Number" />
                <Text text="{HostelModel>MobileNo}" />
                <Label text="Email" />
                <Text text="{HostelModel>CustomerEmail}" />
                <Label text="Country" />
                <Text text="{HostelModel>Country}" />
                <Label text="State" />
                <Text text="{HostelModel>State}" />
                <Label text="{HostelModel>City}" />
                <Text text="{HostelModel>City}" />
            </f:content>
        </f:SimpleForm>
          <!-- ========================= -->
<!-- DOCUMENT SUMMARY PER PERSON -->
<!-- ========================= -->



<VBox
    visible="{= ${HostelModel>Documents}.length > 0 }"
    class="sapUiSmallMargin">

    <Toolbar>
        <Title text="Uploaded Documents" level="H4" />
    </Toolbar>

    <!-- Wrap cards like facility layout -->
    <FlexBox
        wrap="Wrap"
        justifyContent="Start"
        class="sapUiSmallMarginTop"
        alignItems="Start"
        items="{
            path: 'HostelModel>Documents'
        }">

        <VBox
            width="200px"
            height="200px"
            class="serviceCard"
            alignItems="Center"
            justifyContent="Center">

            <!-- Image / PDF Thumbnail -->
            <Image
                src="{HostelModel>Thumbnail}"
                width="180px"
                height="140px"
                densityAware="false"
                press="onOpenDocumentPreview" />
        </VBox>

    </FlexBox>

</VBox>

        <!-- Selected Facilities for THIS person -->
        <Toolbar >
            <Title text="Selected Facilities" level="H4" />
        </Toolbar>
        <FlexBox
             wrap= "Wrap"   
            alignItems="Start"
            justifyContent="Start"
            class="sapUiSmallMarginTop"
         
            items="{
                path: 'HostelModel>PersonFacilitiesSummary'
            }">
            <VBox width="200px" height="200px" class="sapUiSmallMargin serviceCard"
                  alignItems="Center" justifyContent="Center"
                  visible="{= !!${HostelModel>FacilityName} }">
                <Image src="{HostelModel>Image}" width="180px" height="140px" />
                <Text text="{HostelModel>FacilityName}" />
                <Text text="{= ${HostelModel>Price} ? ${HostelModel>Price}+ ' ' + ${HostelModel>Currency} + ' ' + ${HostelModel>/SelectedPriceType} : '' }"/>
            </VBox>
        </FlexBox>

        <!-- Booking Details for THIS person -->
        <Table id="idFacilitySummaryTable"
            class="sapUiSmallMarginTop"
         
            items="{
                path: 'HostelModel>AllSelectedFacilities'
            }"
            mode="SingleSelectLeft"
            inset="false"
            selectionChange="onTableSelection">
            <headerToolbar>
                <Toolbar>
                    <Title text="Booking Details" level="H5" />
                    <ToolbarSpacer />
                    <Button icon="sap-icon://edit" text="Edit" press="onEditFacilityDetails" class="myUnifiedBtn" />
                </Toolbar>
            </headerToolbar>

            <columns>
                <Column demandPopin="true" ><Text text="Facility Name" /></Column>
                <Column demandPopin="true"><Text text="Facility Price" /></Column>
                <Column minScreenWidth="Desktop" demandPopin="true" ><Text text="Start Date" /></Column>
                <Column demandPopin="true" minScreenWidth="Desktop"><Text text="End Date" /></Column>
                <Column minScreenWidth="Desktop" demandPopin="true" ><Text text="Days" /></Column>
                <Column demandPopin="true" ><Text class="sapUiSmallBold" text="Total" /></Column>
            </columns>

            <items>
                <ColumnListItem>
                    <cells>
                        <Text text="{HostelModel>FacilityName}" />
                      <Text 
    text="{= ${HostelModel>Price} + ' ' + ${HostelModel>Currency} + ' ' + ${HostelModel>/SelectedPriceType} }"/>
                        <Text text="{HostelModel>StartDate}" />
                        <Text text="{HostelModel>EndDate}" />
                        <Text text="{HostelModel>TotalDays}" />
                        <Text class="totalColumnBold" text="{= ${HostelModel>TotalAmount}.toFixed(2) + ' ' + ${HostelModel>/Currency} }" />
                    </cells>
                </ColumnListItem>
            </items>
        </Table>

        <!-- Totals for THIS person (NOTE: all RELATIVE, no leading "/") -->
        <VBox class="sapUiSmallMarginTop" visible="{HostelModel>/HasFacilities}">
            <HBox justifyContent="End" class="sapUiSmallMarginTop">
                <Label text="Total Facility Cost:" class="totalColumnBold1 sapUiSmallMarginEnd"/>
                <Text text="{
                   parts: [
        'HostelModel>TotalFacilityPrice',
        'HostelModel>/Currency'
    ], formatter: '.Formatter.formatCurrency'
                }" class="totalColumnBold1 sapUiSmallMarginEnd"/>
              
            </HBox>
            <!-- <HBox justifyContent="End" class="sapUiSmallMarginTop">
                <Label text="Room Rent:" design="Bold" class="sapUiSmallMarginEnd"/>
                <Text text="{path:'HostelModel>/FinalPrice',formatter: '.Formatter.formatCurrency'}" class="sapUiSmallMarginEnd"/>
            </HBox>

            <HBox justifyContent="End" class="sapUiSmallMarginTop">
                <Label text="Grand Total:" design="Bold" class="sapUiSmallMarginEnd"/>
                <Text text="{
                    path: 'HostelModel>GrandTotal',
                    formatter: '.Formatter.formatCurrency'
                }" class="sapUiSmallMarginEnd"/>
            </HBox> -->
        </VBox>

        
         <!-- <VBox visible="{= !!${HostelModel>FileName}}">
        <HBox>
            <Label text="ID Proof Uploaded:" design="Bold" />
            <Link text="{HostelModel>FileName}"
                  target="_blank"
                  href="{= 'data:' + ${HostelModel>FileType} + ';base64,' + ${HostelModel>Document} }"
                  tooltip="Open/Download Attachment" />
        </HBox>
       
        <Image src="{= ${HostelModel>FileType}.startsWith('image/') ? 'data:' + ${HostelModel>FileType} + ';base64,' + ${HostelModel>Document} : '' }"
               width="180px"
               height="auto"
               visible="{= !!${HostelModel>Document}  ${HostelModel>FileType}.startsWith('image/') }"/>
    </VBox> -->

    </Panel>
    <!-- Grand Total section -->
   

</core:FragmentDefinition>
